language: go

go:
  - 1.12.x

os:
  - linux
  # travis enterprise doesn't support osx or windows
  # - osx
  # - windows

go_import_path: github.com/appsody/appsody

services:
  - docker
# skip because dependencies are baked in vendor dir
install:
  # temporarily the controller is checked into github
  # - wget https://github.com/appsody/stacks/releases/download/0.0.1/appsody-controller
  - chmod +x appsody-controller
  - mkdir ~/.appsody
  - cp appsody-controller ~/.appsody/

script:
  - make lint
  - make test


# note before_deploy will run before each deploy provider
before_deploy:
  - make VERSION=${TRAVIS_TAG}  package
  - make deploy

deploy:
  provider: releases
  skip_cleanup: true
  api_key:
    secure: X5TutlGfZxe2Bmzx4AVuIaZDg0fcUpYoET8yjSQvJF8h6Vp8EUIJozSofAb07qboZvKIR95y2/Twjve/8Fzd02NTJkzyJ2gtblM5Wm7p5+1LmlSCP1Bpgf/+3NrUal8S85jpKYTv3dYM5bOUHjhrB4z2pqMAUGXBHjhZ5rSl5f2fYeDQdZWn6VBFy0+4TltJySiiQT2v3NxCFBWc03ug16C4R5zKyhwXWMIShyW5S0aXgK3+hPHCREfue8pH1yR9hScuufSBO4iEj1dxYShb+vwvzOp1O28QO60sRgENt5fjR0y6pl8bTDPvTa1ByOCySIgKuhV0ji4Iy/6LVE4XvVJvop9Ouqp1etD7HJfm9ZNcdDRDthzkB+yxUe08hnzh5L0dVm5/65U7vSPfJ3yAAMLtkZnH0grf50XIq0iS6sNku79s6E15myWlZkcMAWL7CktmY6pLkdhMlt44gWluwk9iIJTeS0Pb0R9WxSmMlxfUDUwAeCkGxjGC+QkeybEiCJ1Vz0twWPnUu9/fFCbJ7a8K5vDuHwo4+boaBhdv/opBGF4IYo/LSW9dS5+oGk69rOllmm1vO+XUV+g1+tUXjaE3uw6CKXQC8LSt9EC9YUV9QHntwviA90iy6IhFHX+K+eQdqxcWyd5bjWvpAeCe+k5i1kUAmh186GQm0j7n9kY=
  file: package/*
  file_glob: true
  on:
    tags: true